[
  {
    "objectID": "finalproject.html",
    "href": "finalproject.html",
    "title": "Final Project- Tahoe National Forest",
    "section": "",
    "text": "library(sf)\nlibrary(stars)\nlibrary(tidyverse)\nlibrary(tmap)\nlibrary(rstac)\nlibrary(gdalcubes)\nlibrary(leaflet.extras2)\nlibrary(terra)\n\n\nurl &lt;- \"https://34c031f8-c9fd-4018-8c5a-4159cdff6b0d-cdn-endpoint.azureedge.net/-/media/calfire-website/what-we-do/fire-resource-assessment-program---frap/gis-data/april-2023/fire221gdb.zip?rev=9e3e1e5e61e242d5b2994d666d72a91a&hash=F424990CD64BB7C4CF01C6CE211C0A59\"\ndownload.file(url, \"fire221.gdb.zip\",  mode=\"wb\")\n\n\nunzip(\"fire221.gdb.zip\")\n\nfire_polys &lt;- \n  read_sf(\"fire22_1.gdb\", layer = \"firep22_1\") |&gt; \n  filter(st_is_valid(Shape))\n\n\nsequoia &lt;- \n  read_sf(\"/vsicurl/https://huggingface.co/datasets/cboettig/biodiversity/resolve/main/data/NPS.gdb\") |&gt; \n  filter(UNIT_NAME == \"Sequoia National Park\") |&gt; \n  st_transform(st_crs(fire_polys))\n\nfire_is_in_sequoia &lt;- st_intersects(fire_polys, sequoia, sparse=FALSE)\nfire_sequoia &lt;- fire_polys |&gt; filter(fire_is_in_sequoia)\n\nWarning: Using one column matrices in `filter()` was deprecated in dplyr 1.1.0.\nâ„¹ Please use one dimensional logical vectors instead.\n\n\n\ntmap_mode(\"view\")\n\ntmap mode set to 'view'\n\ntm_shape(sequoia) + tm_polygons() + \n  tm_shape(fire_sequoia) + tm_polygons(\"YEAR_\")\n\nWarning: Number of levels of the variable assigned to the aesthetic \"fill\" of\nthe layer \"polygons\" is 65, which is larger than n.max (which is 30), so levels\nare combined.\n\n\n\n\n\n\n\n\nbig_fire &lt;- fire_sequoia |&gt; \n  filter(YEAR_ &gt; \"2021\") |&gt; \n  filter(Shape_Area == max(Shape_Area)) \n\n\nbox &lt;- big_fire |&gt; st_transform(4326) |&gt; st_bbox() \nalarm_date &lt;- big_fire$ALARM_DATE\n\nstart_date &lt;- as.character( alarm_date - days(5) )\nend_date &lt;- as.character( alarm_date + days(5) )\n\nitems &lt;-  \n  stac(\"https://planetarycomputer.microsoft.com/api/stac/v1\")  |&gt;\n  stac_search(collections = \"sentinel-2-l2a\",\n              datetime = paste(start_date, end_date, sep=\"/\"),\n              bbox = c(box))  |&gt;\n  post_request() |&gt;\n  items_sign(sign_planetary_computer())\n\n\ncol &lt;- stac_image_collection(items$features, asset_names = c(\"B08\", \"B12\", \"SCL\"))\ncube &lt;- cube_view(srs =\"EPSG:4326\",\n                  extent = list(t0 = start_date, t1 = end_date,\n                                left = box[1], right = box[3],\n                                top = box[4], bottom = box[2]),\n                  dx = 0.0001, dy = 0.0001, dt = \"P1D\")\n\nmask &lt;- image_mask(\"SCL\", values=c(3, 8, 9)) # mask clouds and cloud shadows\ndata &lt;-  raster_cube(col, cube, mask = mask)\n\n\n#finalproject-pull tahoe NF boundary layer (find boundary for Blodgett FRS?)\n\nfire_polys &lt;- \n  read_sf(\"fire22_1.gdb\", layer = \"firep22_1\") |&gt; \n  filter(st_is_valid(Shape))\n\nTahoe &lt;- \n  read_sf(\"S_USA.ProclaimedForest.gdb.zip\") |&gt; \n  filter(FORESTNAME == \"Tahoe National Forest\") |&gt;\n  st_transform(st_crs(fire_polys))\n \nfire_is_in_tahoe &lt;- st_intersects(fire_polys, Tahoe, sparse=FALSE)\nfire_tahoe &lt;- fire_polys |&gt; filter(fire_is_in_tahoe)\n\ntmap_mode(\"view\")\n\ntmap mode set to 'view'\n\ntm_shape(Tahoe) + tm_polygons() + \n  tm_shape(fire_tahoe) + tm_polygons(\"YEAR_\")\n\nWarning: Number of levels of the variable assigned to the aesthetic \"fill\" of\nthe layer \"polygons\" is 96, which is larger than n.max (which is 30), so levels\nare combined."
  }
]